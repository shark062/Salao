<!-- Main container -->
<div class="min-h-screen lg:flex bg-slate-100 dark:bg-slate-950 text-slate-800 dark:text-slate-200 font-sans">
  <!-- Sidebar -->
  <aside class="fixed inset-y-0 left-0 w-64 bg-white dark:bg-slate-900 p-6 flex-col justify-between border-r border-slate-200 dark:border-slate-800 transition-transform duration-300 ease-in-out z-30 lg:relative lg:translate-x-0 flex"
         [class.translate-x-0]="isMenuOpen()"
         [class.-translate-x-full]="!isMenuOpen()">
    <div>
      <div class="text-center mb-10">
        <h2 class="text-2xl font-bold text-indigo-600 dark:text-indigo-400 font-sans tracking-tight">ERIDES SOUZA</h2>
        <p class="text-sm text-slate-500 dark:text-slate-400">Portal do Cliente</p>
      </div>
      <nav class="space-y-2">
        @for(item of [
          { key: 'dashboard', label: 'Início', icon: 'M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6' },
          { key: 'new-appointment', label: 'Agendar', icon: 'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z' },
          { key: 'history', label: 'Histórico', icon: 'M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z' },
          { key: 'profile', label: 'Meu Perfil', icon: 'M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z' }
        ]; track item.key) {
          <button (click)="selectSection(item.key)" 
                  class="w-full flex items-center space-x-3 px-4 py-2 rounded-lg transition-all duration-200 transform hover:scale-105"
                  [class]="activeSection() === item.key ? 'bg-indigo-100 dark:bg-indigo-500/20 text-indigo-600 dark:text-indigo-300' : 'text-slate-700 dark:text-slate-300 hover:bg-slate-200/50 dark:hover:bg-slate-800/50'">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" [attr.d]="item.icon" /></svg>
            <span>{{ item.label }}</span>
          </button>
        }
      </nav>
    </div>
    <button (click)="logout()" class="w-full flex items-center space-x-3 px-4 py-2 rounded-lg text-slate-700 dark:text-slate-300 hover:bg-red-100 dark:hover:bg-red-800/50 transition-colors duration-200 transform hover:scale-105 active:scale-100">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
        <span>Sair</span>
    </button>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-4 sm:p-8 overflow-y-auto">
    <header class="flex justify-between items-center mb-8">
      <button class="lg:hidden p-2 text-slate-500 dark:text-slate-400" (click)="toggleMenu()"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg></button>
      <h1 class="text-3xl font-bold text-indigo-600 dark:text-indigo-400 capitalize">{{ activeSection() === 'dashboard' ? 'Início' : activeSection() === 'new-appointment' ? 'Novo Agendamento' : activeSection() === 'history' ? 'Histórico' : 'Meu Perfil' }}</h1>
      <div class="flex items-center space-x-4">
        <span class="text-slate-700 dark:text-slate-300 hidden sm:inline">Olá, {{ currentUser()?.name?.split(' ')[0] }}!</span>
        <app-theme-toggle />
        <img [src]="currentUser()?.photoUrl || 'https://api.dicebear.com/8.x/initials/svg?seed=' + currentUser()?.name" alt="Foto de Perfil" class="w-10 h-10 rounded-full object-cover border-2 border-indigo-500/50">
      </div>
    </header>

    @switch (activeSection()) {
      @case ('dashboard') {
        <div class="animate-fade-in-down">
          <h1 class="text-2xl md:text-3xl font-bold text-slate-900 dark:text-slate-100">Bem-vinda de volta, {{ currentUser()?.name }}!</h1>
          <p class="text-slate-600 dark:text-slate-400 mt-2">Seu espaço de beleza e bem-estar.</p>
          <div class="mt-8">
            <h2 class="text-2xl font-semibold text-indigo-600 dark:text-indigo-300">Próximos Agendamentos</h2>
            @if (upcomingAppointments().length > 0) {
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-4">
                @for (app of upcomingAppointments(); track app.id) {
                  <div class="bg-white dark:bg-slate-900 p-6 rounded-xl shadow-lg shadow-slate-400/20 dark:shadow-black/20 transform transition-transform hover:scale-105 bg-gradient-to-br from-indigo-50 dark:from-slate-900 to-white dark:to-slate-800/50 border border-slate-200 dark:border-slate-800"><div class="flex items-center"><span class="text-4xl mr-4">{{ app.emoji }}</span><div><h3 class="text-xl font-bold text-slate-800 dark:text-slate-100">{{ app.serviceName }}</h3><p class="text-slate-600 dark:text-slate-400">{{ app.date | date:'EEEE, dd/MM/yyyy' }} às {{ app.time }}</p></div></div></div>
                }
              </div>
            } @else {
              <div class="mt-4 bg-white dark:bg-slate-900 p-8 rounded-lg shadow-lg text-center border border-slate-200 dark:border-slate-800"><h3 class="text-xl font-semibold">Tudo em dia!</h3><p class="text-slate-500 dark:text-slate-400 mt-2">Você não tem nenhum agendamento futuro. Que tal agendar seu próximo momento de cuidado?</p><button (click)="selectSection('new-appointment')" class="mt-6 bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-all transform hover:scale-105 active:scale-95 shadow-lg shadow-indigo-500/30">Agendar um serviço</button></div>
            }
          </div>
        </div>
      }
      @case ('new-appointment') {
        <div class="animate-fade-in-down max-w-4xl mx-auto"><div class="bg-white dark:bg-slate-900 p-8 rounded-lg border border-slate-200 dark:border-slate-800 shadow-lg"><form (ngSubmit)="bookAppointment()" class="space-y-8">
          <fieldset><legend class="text-xl font-semibold text-indigo-600 dark:text-indigo-300 mb-4">Detalhes do Agendamento</legend><div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div><label class="block text-sm font-medium text-indigo-600/80 dark:text-indigo-400/80 mb-1">Serviço</label><select name="service" [(ngModel)]="selectedServiceId" required class="w-full bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg px-3 py-2 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"><option [ngValue]="null" disabled>Selecione</option>@for(s of services();track s.id){<option [ngValue]="s.id">{{s.name}} - {{s.price|currency:'BRL'}}</option>}</select></div>
            <div><label class="block text-sm font-medium text-indigo-600/80 dark:text-indigo-400/80 mb-1">Data</label><input type="date" name="date" [(ngModel)]="appointmentDate" required class="w-full bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg px-3 py-2 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"></div>
            <div><label class="block text-sm font-medium text-indigo-600/80 dark:text-indigo-400/80 mb-1">Hora</label><input type="time" name="time" [(ngModel)]="appointmentTime" required class="w-full bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg px-3 py-2 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"></div>
          </div></fieldset>
          <fieldset class="pt-8 border-t border-slate-200 dark:border-slate-700"><legend class="text-xl font-semibold text-indigo-600 dark:text-indigo-300">Questionário</legend><p class="text-sm text-slate-500 dark:text-slate-400 mb-6">Responda para garantirmos o melhor atendimento.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
              @for(q of yesNoQuestions; track q.key) {<div><label class="font-medium text-slate-800 dark:text-slate-200">{{q.label}}</label><div class="flex items-center space-x-2 mt-2">@for(opt of ['sim','nao'];track opt){<label class="flex-1 cursor-pointer p-3 text-center border rounded-md transition-all duration-200 transform hover:scale-105 text-sm" [class.bg-indigo-600]="questionnaire()[q.key]===opt" [class.text-white]="questionnaire()[q.key]===opt" [class.border-indigo-600]="questionnaire()[q.key]===opt" [class.font-bold]="questionnaire()[q.key]===opt" [class.hover:bg-slate-100]="questionnaire()[q.key]!==opt" [class.dark:hover:bg-slate-800]="questionnaire()[q.key]!==opt" [class.border-slate-300]="questionnaire()[q.key]!==opt" [class.dark:border-slate-600]="questionnaire()[q.key]!==opt"><input type="radio" [name]="q.key" [value]="opt" class="sr-only" (change)="updateQuestionnaireField(q.key, opt)"><span>{{opt|titlecase}}</span></label>}</div></div>}
              <div class="md:col-span-2"><label class="font-medium text-slate-800 dark:text-slate-200">Como está sua lâmina ungueal?</label><div class="grid grid-cols-2 sm:grid-cols-4 gap-2 mt-2">@for(o of laminaUnguealOptions;track o){<label class="flex items-center justify-center cursor-pointer p-3 border rounded-md transition-all duration-200 transform hover:scale-105 text-sm" [class.bg-indigo-500/10]="isLaminaUnguealSelected(o)" [class.dark:bg-indigo-400/10]="isLaminaUnguealSelected(o)" [class.border-indigo-500]="isLaminaUnguealSelected(o)" [class.dark:border-indigo-400]="isLaminaUnguealSelected(o)" [class.text-indigo-600]="isLaminaUnguealSelected(o)" [class.dark:text-indigo-300]="isLaminaUnguealSelected(o)" [class.font-semibold]="isLaminaUnguealSelected(o)" [class.hover:bg-slate-100]="!isLaminaUnguealSelected(o)" [class.dark:hover:bg-slate-800]="!isLaminaUnguealSelected(o)" [class.border-slate-300]="!isLaminaUnguealSelected(o)" [class.dark:border-slate-600]="!isLaminaUnguealSelected(o)"><input type="checkbox" [value]="o" [checked]="isLaminaUnguealSelected(o)" (change)="onLaminaUnguealChange($event)" class="sr-only"><span class="capitalize">{{o}}</span></label>}</div></div>
              <div class="md:col-span-2"><label for="outros" class="font-medium text-slate-800 dark:text-slate-200">Algo mais que devamos saber?</label><textarea id="outros" rows="3" [value]="questionnaire().outros" (input)="onOutrosInputChange($event)" class="mt-2 w-full bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg px-3 py-2 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea></div>
            </div>
          </fieldset>
          <div class="flex justify-end pt-4"><button type="submit" [disabled]="!selectedServiceId() || !appointmentDate() || !appointmentTime() || isSaving()" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-indigo-700 transition-all transform hover:scale-105 active:scale-95 disabled:bg-slate-300 dark:disabled:bg-slate-600 disabled:cursor-wait disabled:opacity-50 shadow-lg shadow-indigo-500/30">{{ isSaving() ? 'Agendando...' : 'Confirmar Agendamento' }}</button></div>
        </form></div></div>
      }
      @case ('history') {
        <div class="animate-fade-in-down"><div class="bg-white dark:bg-slate-900 rounded-lg border border-slate-200 dark:border-slate-800 shadow-lg">@if(userAppointments().length>0){<ul class="divide-y divide-slate-200 dark:divide-slate-800">@for(app of userAppointments();track app.id){<li class="p-4 hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors duration-200"><div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3"><div class="flex items-center"><span class="text-3xl mr-4">{{app.emoji}}</span><div><p class="text-lg font-semibold text-slate-800 dark:text-slate-100">{{app.serviceName}}</p><p class="text-sm text-slate-500 dark:text-slate-400">{{app.date|date:'dd/MM/yyyy'}} às {{app.time}}</p></div></div><span class="px-3 py-1 text-sm font-semibold rounded-full" [class.bg-green-100]="app.status==='confirmed'" [class.dark:bg-green-500/20]="app.status==='confirmed'" [class.text-green-800]="app.status==='confirmed'" [class.dark:text-green-400]="app.status==='confirmed'" [class.bg-yellow-100]="app.status==='pending'" [class.dark:bg-yellow-500/20]="app.status==='pending'" [class.text-yellow-800]="app.status==='pending'" [class.dark:text-yellow-400]="app.status==='pending'" [class.bg-red-100]="app.status==='cancelled'" [class.dark:bg-red-500/20]="app.status==='cancelled'" [class.text-red-800]="app.status==='cancelled'" [class.dark:text-red-400]="app.status==='cancelled'">{{app.status|titlecase}}</span></div></li>}</ul>} @else {<div class="p-8 text-center"><p class="text-slate-500 dark:text-slate-400">Você ainda não realizou nenhum agendamento.</p></div>}</div></div>
      }
       @case ('profile') {
        <div class="animate-fade-in-down max-w-2xl mx-auto"><div class="bg-white dark:bg-slate-900 p-6 md:p-8 rounded-lg border border-slate-200 dark:border-slate-800 shadow-lg">
          <h2 class="text-xl font-semibold mb-6 text-indigo-600 dark:text-indigo-300">Editar Perfil</h2>
          <div class="flex flex-col items-center space-y-4 mb-8">
            <img [src]="profilePicture()" alt="Foto de Perfil" class="w-32 h-32 rounded-full object-cover border-4 border-indigo-500/30"><label class="cursor-pointer bg-slate-200 hover:bg-slate-300 dark:bg-slate-700/80 dark:hover:bg-slate-700 text-slate-800 dark:text-slate-200 font-bold py-2 px-4 rounded-lg transition-all transform hover:scale-105 active:scale-95"><span>Mudar Foto</span><input type="file" class="hidden" (change)="onFileSelected($event)" accept="image/*"></label>
          </div>
          <form (ngSubmit)="saveProfileChanges()" class="space-y-4">
            <div><label class="block text-sm font-medium text-indigo-600/80 dark:text-indigo-400/80 mb-1">Nome</label><input type="text" [value]="editingProfileData().name || ''" (input)="handleProfileFormChange($event, 'name')" class="w-full bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg px-3 py-2 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"></div>
            <div><label class="block text-sm font-medium text-indigo-600/80 dark:text-indigo-400/80 mb-1">Email</label><input type="email" [value]="editingProfileData().email || ''" (input)="handleProfileFormChange($event, 'email')" class="w-full bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg px-3 py-2 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"></div>
            <div><label class="block text-sm font-medium text-indigo-600/80 dark:text-indigo-400/80 mb-1">Nova Senha</label><input type="password" placeholder="Deixe em branco para não alterar" (input)="handleProfileFormChange($event, 'newPassword')" class="w-full bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg px-3 py-2 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"></div>
            @if (editError()) {<div class="bg-red-100 dark:bg-red-900/50 border border-red-300 dark:border-red-700 text-red-800 dark:text-red-300 px-4 py-2 rounded-lg text-sm">{{ editError() }}</div>}
            <div class="flex justify-end pt-4"><button type="submit" [disabled]="isSaving()" class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-700 transition-all transform hover:scale-105 active:scale-95 disabled:bg-slate-300 dark:disabled:bg-slate-600 disabled:cursor-wait disabled:opacity-50">{{ isSaving() ? 'Salvando...' : 'Salvar Alterações' }}</button></div>
          </form>
        </div></div>
      }
    }
  </main>
</div>